name: Build gRPC Win
agent:
  type: Unity::VM
  image: ml-agents/ml-agents-grpc-builder-win:latest
  flavor: b1.large
commands:
  - |
    git submodule update --init
    md artifacts\native\win
    cd cmake
    md .build
    cd .build
    call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Auxiliary\Build\vcvarsall.bat" x64
    call "%VS150COMNTOOLS%..\..\VC\vcvarsall.bat" x64
    cmake ..\.. -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON
    cmake --build .
    copy *.dll ..\..\artifacts\native\win\
artifacts:
  libraries:
    paths:
      - "artifacts/**"
