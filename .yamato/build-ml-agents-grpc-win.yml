name: Build gRPC Win
agent:
  type: Unity::VM
  image: desktop/desktop-vs2017:v0.1.0-602685
  flavor: b1.large
commands:
  - |
    choco install nasm
    choco install ninja
    choco install strawberryperl
    git submodule update --init
    md artifacts\native\win
    cd cmake
    md build
    cd build
    call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Auxiliary\Build\vcvarsall.bat" x64
    call "%VS150COMNTOOLS%..\..\VC\vcvarsall.bat" x64
    cmake ..\.. -GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON
    cmake --build .
    move *.dll ..\..\artifacts\native\win\
artifacts:
  libraries:
    paths:
      - "artifacts/**"
